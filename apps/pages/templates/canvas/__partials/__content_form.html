{% load i18n widget_tweaks static %}
<style>
    .modal {
    overflow-y:auto;
    }
</style>
<form class="form" id="content-form" name="form" method="post" enctype='multipart/form-data'>
    {% csrf_token %}
    {% if errors %}
        <div class="alert alert-outline-primary mb-2 mt-2 accept-drop" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-x text-black close" data-dismiss="alert">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <i class="flaticon-cancel-12 close text-black" data-dismiss="alert"></i>
            {{errors}}
        </div>
    {% endif %}
    {% if message %}
        <div class="alert alert-outline-primary mb-2 mt-2 accept-drop" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-x text-black close" data-dismiss="alert">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <i class="flaticon-cancel-12 close text-black" data-dismiss="alert"></i>
            {{message}}
        </div>
    {% endif %}
    {% if instance.block.has_title %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.title|add_label_class:''}}
                {{ form.title|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.title.errors %}
                    <div class="invalid-feedback">
                        {{form.title.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_subtitle %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.subtitle|add_label_class:''}}
                {{ form.subtitle|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.subtitle.errors %}
                    <div class="invalid-feedback">
                        {{form.subtitle.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_image %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.image|add_label_class:''}}
                {{ form.image|append_attr:"class:form-control filemanager-widget"|add_error_attr:"class:is-invalid"}}
                {% if form.image.errors %}
                    <div class="invalid-feedback">
                        {{form.image.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_image_second %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.image_second|add_label_class:''}}
                {{ form.image_second|append_attr:"class:form-control filemanager-widget"|add_error_attr:"class:is-invalid"}}
                {% if form.image_second.errors %}
                    <div class="invalid-feedback">
                        {{form.image_second.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_url %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.url|add_label_class:''}}
                {{ form.url|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.url.errors %}
                    <div class="invalid-feedback">
                        {{form.url.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_url_text %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.url_text|add_label_class:''}}
                {{ form.url_text|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.url_text.errors %}
                    <div class="invalid-feedback">
                        {{form.url_text.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_video %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.video|add_label_class:''}}
                {{ form.video|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.video.errors %}
                    <div class="invalid-feedback">
                        {{form.video.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_embed %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.embed|add_label_class:''}}
                {{ form.embed|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.embed.errors %}
                    <div class="invalid-feedback">
                        {{form.embed.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_content %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.content|add_label_class:''}}
                {{ form.content|append_attr:"class:form-control tinymce-editor"|add_error_attr:"class:is-invalid"}}
                {% if form.content.errors %}
                    <div class="invalid-feedback">
                        {{form.content.errors}}
                    </div>
                {% endif %}
            </div>
        </div>          
    {% endif %}
    {% if instance.block.has_sort_method %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.sort|add_label_class:''}}
                {{ form.sort|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.sort.errors %}
                    <div class="invalid-feedback">
                        {{form.sort.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_limit %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.limit|add_label_class:''}}
                {{ form.limit|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.limit.errors %}
                    <div class="invalid-feedback">
                        {{form.limit.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_sort_order %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.sort_order|add_label_class:''}}
                {{ form.sort_order|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.sort_order.errors %}
                    <div class="invalid-feedback">
                        {{form.sort_order.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_pagination %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.paginated|add_label_class:''}}
                {{ form.paginated|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.paginated.errors %}
                    <div class="invalid-feedback">
                        {{form.paginated.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_form %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.form|add_label_class:''}}
                {{ form.form|append_attr:"class:form-control basic"|add_error_attr:"class:is-invalid"}}
                {% if form.form.errors %}
                    <div class="invalid-feedback">
                        {{form.form.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_detailpage %}
        <div class="form-group row">
            <div class="col-sm-12 ml-2">
                {{ form.detailpage|add_label_class:''}}
                {{ form.detailpage|append_attr:"class:form-control"|add_error_attr:"class:is-invalid"}}
                {% if form.detailpage.errors %}
                    <div class="invalid-feedback">
                        {{form.detailpage.errors}}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if instance.block.has_block_elements %}
        <div class="table-responsive">
            <input type="button" class="btn btn-gradient-info" value="{% trans 'Add more block elements' %}" id="add_more">
            <div id="style-2_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4 no-footer">
                <table id="style-2" class="table style-2 table-hover dataTable no-footer">
                    <tbody>
                        {% for block in block_elements %}
                            <tr class="main-tr" id="{{block.id}}">
                                <td colspan="2">
                                    <h3>{% trans 'Blok element' %}&nbsp;{{forloop.counter}}</h3>
                                    <svg data-block_elem="{{block.id}}" class="save-block-element" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-save"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                                    <svg data-block_elem="{{block.id}}" class="delete-block-element"
                    xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line
                    x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                    {% if instance.block.has_block_element_title %}
                                    <div class="row mt-3">
                                        <div class="col-2">{% trans 'Titel' %}</div>
                                        <div class="col-10"><input type="text" class="form-control" value="{{block.title|default_if_none:""}}" name="block_elem_title" id="block_elem_title_{{block.id}}"></div>
                                    </div>
                                    {% endif %}
                                

                                {% if instance.block.has_block_element_image %}
                                    <div class="row mt-3">
                                        <div class="col-2">{% trans 'Afbeelding' %}</div>
                                        <div class="row col-10">
                                            <div class="col-md-8">
                                                <input type="text" name="block_elem_image" value="{{block.image|default_if_none:""}}" class="filemanager-widget form-control modal-open-check" id="block_elem_image_{{block.id}}">
                                            </div>
                                            <div class="input-group-append col-md-4">
                                                <button class="btn btn-block btn-dark browse-filemanager" type="button">{% trans 'Browse' %}</button>
                                            </div>
                                        </div>
                                        <script src="{% static 'admin/js/libs/jquery-3.6.0.min.js' %}"></script>
                                        <script src="{% static 'admin/bootstrap/js/bootstrap.min.js' %}"></script>
                                        <script>
                                            $('.browse-filemanager').on('click', function() {
                                                function getCookie(name) {
                                                    var cookieValue = null; 
                                                    if (document.cookie && document.cookie !== '') {
                                                        var cookies = document.cookie.split(';');
                                                        for (var i = 0; i < cookies.length; i++) {
                                                            var cookie = jQuery.trim(cookies[i]);
                                                            // Does this cookie string begin with the name we want?
                                                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                                                break;
                                                            }
                                                        }
                                                    }
                                                    return cookieValue;
                                                }
                                                var csrftoken = getCookie('csrftoken');
                                                $.ajax({
                                                    type: 'POST',
                                                    url: '{% url 'get_filemanager' %}',
                                                    data: {
                                                        'csrfmiddlewaretoken': csrftoken,
                                                        'type': 'image'
                                                    },
                                                    success: function(data){
                                                        $('#filemanagerModal').modal();
                                                        $('.get-filemanager').html(data.template);                                                    
                                                    },
                                                })
                                                
                                            });
                                        </script>
                                    </div>
                                {% endif %}
                    
                                {% if instance.block.has_block_element_content %}
                                    <div class="row mt-3">
                                        <div class="col-2">{% trans 'Inhoud' %}</div>
                                        <div class="col-10"><textarea name="block_element_content" class="form-control tinymce-editor" id="block_elem_content_{{block.id}}" cols="30" rows="10">{{block.content|default_if_none:""}}</textarea></div>
                                    </div>
                                {% endif %}
                                {% if instance.block.has_block_element_subtitle %}
                                    <div class="row mt-3">
                                        <div class="col-2">{% trans 'Subtitel' %}</div>
                                        <div class="col-10"><input type="text" value="{{block.subtitle|default_if_none:""}}" class="form-control" name="block_elem_subtitle" id="block_elem_subtitle_{{block.id}}"></div>
                                    </div>
                                {% endif %}
                                {% if instance.block.has_block_element_url %}
                                    <div class="row mt-3">
                                        <div class="col-2">{% trans 'URL' %}</div>
                                        <div class="col-10"><input type="text" value="{{block.url|default_if_none:""}}" class="form-control" name="block_elem_url" id="block_elem_url_{{block.id}}"></div>
                                    </div>
                                {% endif %}
                                {% if instance.block.has_block_element_url_text %}
                                    <div class="row mt-3">
                                        <div class="col-2">{% trans 'URL Tekst' %}</div>
                                        <div class="col-10"><input type="text" value="{{block.url_text|default_if_none:""}}" class="form-control" name="block_elem_url_text" id="block_elem_url_text_{{block.id}}"></div>
                                    </div>
                                {% endif %}
                                {% if instance.block.has_block_element_image_second %}
                                    <div class="row mt-3">
                                        <div class="col-2">{% trans 'Tweede afbeelding' %}</div>
                                        <div class="col-10"><input type="text" value="{{block.image_second|default_if_none:""}}" class="form-control" name="block_elem_image_second" id="block_elem_second_image_{{block.id}}"></div>
                                    </td>
                                </tr>
                                    
                                {% endif %}
                                <tr>
                                    <td colspan="2"><hr style="    color: #212529;
                                        background-color: #212529;
                                        height: 3px;"></td>
                                </tr>
                            </tr>
                            <!-- {% if instance.block.has_block_element_title %}
                                <tr>
                                    <td>{% trans 'Titel' %}</td>
                                    <td><input type="text" class="form-control" value="{{block.block_element_title|default_if_none:""}}" name="block_elem_title" id="block_elem_title_{{block.id}}"></td>
                                </tr>
                            {% endif %} -->
                            <!-- {% if instance.block.has_block_element_image %}
                                <tr>
                                    <td>{% trans 'Afbeelding' %}</td>
                                    <td><div class="row">
                                        <div class="col-md-8">
                                            <input type="text" name="block_elem_image" value="{{block.block_element_image|default_if_none:""}}" class="filemanager-widget form-control modal-open-check" id="block_elem_image_{{block.id}}">
                                        </div>
                                        <div class="input-group-append col-md-4">
                                            <button class="btn btn-block btn-dark browse-filemanager" type="button">{% trans 'Browse' %}</button>
                                        </div>
                                    </div>
                                    <script src="{% static 'admin/js/libs/jquery-3.6.0.min.js' %}"></script>
                                    <script src="{% static 'admin/bootstrap/js/bootstrap.min.js' %}"></script>
                                    <script>
                                        $('.browse-filemanager').on('click', function() {
                                            function getCookie(name) {
                                                var cookieValue = null; 
                                                if (document.cookie && document.cookie !== '') {
                                                    var cookies = document.cookie.split(';');
                                                    for (var i = 0; i < cookies.length; i++) {
                                                        var cookie = jQuery.trim(cookies[i]);
                                                        // Does this cookie string begin with the name we want?
                                                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                                            break;
                                                        }
                                                    }
                                                }
                                                return cookieValue;
                                            }
                                            var csrftoken = getCookie('csrftoken');
                                            $.ajax({
                                                type: 'POST',
                                                url: '{% url 'get_filemanager' %}',
                                                data: {
                                                    'csrfmiddlewaretoken': csrftoken,
                                                    'type': 'image'
                                                },
                                                success: function(data){
                                                    $('#filemanagerModal').modal();
                                                    $('.get-filemanager').html(data.template);                                                    
                                                },
                                            })
                                            
                                        });
                                    </script></td>
                                </tr>
                            {% endif %}
                            {% if instance.block.has_block_element_content %}
                                <tr>
                                    <td>{% trans 'Inhoud' %}</td>
                                    <td><textarea name="block_element_content" class="form-control tinymce-editor" id="block_elem_content_{{block.id}}" cols="30" rows="10">{{block.block_element_content|default_if_none:""}}</textarea></td>
                                </tr>
                            {% endif %}
                            {% if instance.block.has_block_element_subtitle %}
                                <tr>
                                    <td>{% trans 'Subtitel' %}</td>
                                    <td><input type="text" value="{{block.block_element_subtitle|default_if_none:""}}" class="form-control" name="block_elem_subtitle" id="block_elem_subtitle_{{block.id}}"></td>
                                </tr>
                            {% endif %}
                            {% if instance.block.has_block_element_image_second %}
                                <tr>
                                    <td>{% trans 'Tweede afbeelding' %}</td>
                                    <td><input type="text" value="{{block.block_element_image_second|default_if_none:""}}" class="form-control" name="block_elem_image_second" id="block_elem_second_image_{{block.id}}"></td>
                                </tr>
                                
                            {% endif %}
                            <tr>
                                <td colspan="2"><hr style="    color: #212529;
                                    background-color: #212529;
                                    height: 3px;"></td>
                            </tr> -->
                        {% empty %} 
                                <p>{% trans 'Er zijn nog geen blok elementen' %}</p>
                        {% endfor %}
                    </tbody>
                </table><!--end /table-->
            </div>
        </div><!--end /tableresponsive-->
    {% endif %}
    {% include 'filemanager/filemanager-modal.html' %}
    <span class="block-data" data-block="{{block}}" data-page="{{page}}"></span>
    <a href="javascript:void(0)" class="btn btn-success submit-content-form"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-save"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg> {% trans 'Opslaan' %}</a>
</form>
<script>
    // to be used by tinyMCE file_picker_callback
    var filemanager_url = "{% url 'get_filemanager' %}";
    var temp_config_url = "{% url 'get-tineymce-template-config' %}";
</script>
<script>
    $('.submit-content-form').on('click', function(e){
        e.preventDefault();
        tinymce.triggerSave(true, true);
        var serializedData = $('#content-form').serialize();
        var csrf = $('.canvas-builder').data('csrf');
        var block = $('.block-data').data('block');
        $.ajax({
            type: 'POST',
            url: '{% url 'canvascontent' %}',
            data: serializedData + '&block=' + block, 
            success: function(data){
                if(data.success) {
                    //location.reload();
                }
                $('.block-content').html(data.template); 
                tinymce.remove();
                tinymce.init({
                    selector: '.form-control.tinymce-editor',
                    plugins: [
                        'advlist autolink autoresize link image imagetools lists charmap print preview hr anchor pagebreak',
                        'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
                        'table emoticons template paste help hr template'
                    ],
                    image_uploadtab: true,
                    images_upload_base_path: '/media/tinymce',
                    toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | ' +
                        'bullist numlist outdent indent | link image | print preview media fullpage | ' +
                        'forecolor backcolor emoticons | help template',
                    menubar: 'favs file edit view insert format tools table help',
                    templates: temp_config_url,
                });
            },
        })
    });
</script>
<script>
    $('#add_more').click(function(e) {
        e.preventDefault();
        var serializedData = $('#content-form').serialize();
        var csrf = $('.canvas-builder').data('csrf');
        var block = $('.block-data').data('block');
        $.ajax({
            type: 'POST',
            url: '{% url 'canvascontent' %}',
            data: serializedData + '&block=' + block + '&action=createelement', 
            success: function(data){
                if(data.success) {
                    //location.reload();
                }
                $('.block-content').html(data.template);  
                tinymce.remove();
                tinymce.init({
                    selector: '.form-control.tinymce-editor',
                    plugins: [
                        'advlist autolink autoresize link image imagetools lists charmap print preview hr anchor pagebreak',
                        'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
                        'table emoticons template paste help hr template'
                    ],
                    force_br_newlines : true,
                    force_p_newlines : true,
                    image_uploadtab: true,
                    images_upload_base_path: '/media/tinymce',
                    toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | ' +
                        'bullist numlist outdent indent | link image | print preview media fullpage | ' +
                        'forecolor backcolor emoticons | help template',
                    menubar: 'favs file edit view insert format tools table help',
                    templates: temp_config_url,
                });
                    
            },
        })
    });
</script>
<script>
    $('.delete-block-element').click(function(e) {
        e.preventDefault();
        tinymce.triggerSave(true, true);
        var serializedData = $('#content-form').serialize();
        var csrf = $('.canvas-builder').data('csrf');
        var block = $('.block-data').data('block');
        var block_elem = $(this).data('block_elem');
        $.ajax({
            type: 'POST',
            url: '{% url 'canvascontent' %}',
            data: serializedData + '&block=' + block + '&action=deleteelement&block_elem=' + block_elem, 
            success: function(data){
                if(data.success) {
                    //location.reload();
                }
                $('.block-content').html(data.template); 
                tinymce.remove();
                tinymce.init({
                    selector: '.form-control.tinymce-editor',
                    plugins: [
                        'advlist autolink autoresize link image imagetools lists charmap print preview hr anchor pagebreak',
                        'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
                        'table emoticons template paste help hr template'
                    ],
                    force_br_newlines : true,
                    force_p_newlines : true,
                    image_uploadtab: true,
                    images_upload_base_path: '/media/tinymce',
                    toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | ' +
                        'bullist numlist outdent indent | link image | print preview media fullpage | ' +
                        'forecolor backcolor emoticons | help template',
                    menubar: 'favs file edit view insert format tools table help',
                    templates: temp_config_url,
                });
                
            },
        })
    });
</script>
<script>
    $('.save-block-element').click(function(e) {
        e.preventDefault();
        tinymce.triggerSave(true, true); 
        var serializedData = $('#content-form').serialize();
        var csrf = $('.canvas-builder').data('csrf');
        var block = $('.block-data').data('block');
        var block_elem = $(this).data('block_elem');
        var title = $('#block_elem_title_' + block_elem).val();
        var content = $('#block_elem_content_' + block_elem).val();
        var image = $('#block_elem_image_' + block_elem).val();
        var subtitle = $('#block_elem_subtitle_' + block_elem).val();
        var second_image = $('#block_elem_second_image_' + block_elem).val();
        var url = $('#block_elem_url_' + block_elem).val();
        var url_text = $('#block_elem_url_text_' + block_elem).val();
        $.ajax({
            type: 'POST',
            url: '{% url 'canvascontent' %}',
            data: serializedData + '&block=' + block + '&action=saveelement&block_elem=' + block_elem + '&title=' + title + '&content=' + content + '&image=' + image + '&subtitle=' + subtitle + '&second_image=' + second_image + '&url=' + url + '&url_text=' + url_text, 
            success: function(data){
                if(data.success) {
                    //location.reload();
                }
                $('.block-content').html(data.template);
                tinymce.remove();
                tinymce.init({
                    selector: '.form-control.tinymce-editor',
                    plugins: [
                        'advlist autolink autoresize link image imagetools lists charmap print preview hr anchor pagebreak',
                        'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
                        'table emoticons template paste help hr template'
                    ],
                    image_uploadtab: true,
                    images_upload_base_path: '/media/tinymce',
                    toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | ' +
                        'bullist numlist outdent indent | link image | print preview media fullpage | ' +
                        'forecolor backcolor emoticons | help template',
                    menubar: 'favs file edit view insert format tools table help',
                    templates: temp_config_url,
                });
            },
        })
    });
    $(document).on('focusin', function(e) {
        if ($(e.target).closest(".tox-textfield").length)
            e.stopImmediatePropagation();
    });
    $(document).on('focusin', (e) => {
        if ($(e.target).closest('.mce-window').length) {
            $('.ModalHeader').attr('tabindex', '');
        }
    });
    $(document).on('focusin', (e) => {
        if ($(e.target).closest('.mce-window').length) {
            e.stopImmediatePropagation(); 
        }
    }); 
    $(document).on('focusin', function(e) {
        if ($(e.target).closest(".tox-tinymce-aux, .moxman-window, .tam-assetmanager-root, .tox-dialog").length) {
            $('.tox-dialog').css('z-index', '2003');
            e.stopImmediatePropagation();
        }
    });
</script>
<script src="{% static 'admin/js/libs/jquery-ui.js' %}"></script>
<script>
    $('#style-2 tbody').sortable({
            items: '.main-tr',
            opacity: 1,
            update: function () {
                move($('#style-2 tbody').sortable('serialize', 'id'));
            }
        });
        function move(order) {
            order = order.replaceAll('[]=', '');
            $.ajax({
                type: 'POST',
                url: '{% url 'pageblockelement_reorder' %}',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'item': order
                },
                success: function () {
                    //OK
                }
            });
        }
</script>